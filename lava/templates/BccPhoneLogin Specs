
+ NOTE: Create new 'PIN' logins on the person profile page / security

com.baysideonline.BccBlocks

- PhoneLoginHelper.cs

+ public class PhoneLoginHelper
    + private RockContext _context;
    + public PhoneLoginHelper(RockContext context)
        + set _context
    + public int? GetPersonIdByPhoneNumber(string number)
        + phone number service
        + strip everything except numbers out of string
        + query DB to get a phone number (compare with 'Number' field)
            + if not found, return null
            + if found return 'PersonId' field
    + public bool CheckCodeForPersonId(int id, int code)
        + UserLoginService
        + Query for userlogin based on PersonId = 'Id' and UserName = code and EntityTypeId = 233
        + If found..
            + ensure LastPasswordChangedDateTime is less than 30 minutes ago, if not return false
        + If not found...
            + return false
        + return false
    + public void DeleteUserLogin(int personId, int code)
        + create new UserLoginService
        + delete the login where PersonId = personId and UserName = code and EntityTypeId = 233
        + save context changes
    + public UserLogin CreateUserLoginForPersonId(int id)
        + create new RockContext
        + create new UserLoginService w/ context
        + generate a random 5 digit number - google it :) - also make sure that the 5 digits is never 81913
            + query for a user login with the username matching the random 5 digits
            + if found..
                + set personId of that user login to the provided 'id'
                + set LastPasswordChangedDateTime = now
                + save context changes
                + return the user login
            + if not found, create a new UserLogin with the following parameters
                + UserName = random 5 digits
                + IsConfirmed = true
                + set LastPasswordChangedDateTime = now
                + PersonId = 'id'
                + Guid = new guid
                + EntiTypeId = 233 (pin authentication)
                + CreatedDateTime = now
                + ModifiedDateTime = now
                + add w/ service
                + save context changes
                + return the user login

RockWeb.Plugins.com_baysideonline.BccBlocksUI

- BccPhoneLogin.ascx

+ Ref this: https://github.com/BaysideChurch/BccMondayUI/blob/master/BccMondayBoardDetail.ascx for how to structure the block
+ There will be 'screens' - see flow chart

+ wrap everything in an asp:UpdatePanel
    + div ID="dAlertError" class="alert alert-danger"
    + asp:Panel ID="pnlInitial"
        + h1 What's your phone number?
        + ref: https://github.com/SparkDevNetwork/Rock/blob/develop/RockWeb/Blocks/Security/AccountEntry.ascx LINE 60-61 for phone number control
        + div class="actions"
            + asp:LinkButton: 'Next' ID="lbInitialNext" class="btn btn-primary"
            + asp:LinkButton: 'Create Account' ID="lbInitialCreateAccount" class="btn-btn-secondary"

    + asp:Panel ID="pnlAccountEntry"
        - skip this for now

    + asp:Panel ID="pnlCodeEntry"
        + h1: We've just sent you a code.
        + Rock:NumberBox ID="tbCode"
        + div class="actions"
            + asp:LinkButton: 'Next' ID="lbCodeEntryNext" class="btn btn-primary"
            + asp:LinkButton: 'Re-Send Code' ID="lbCodeEntryReSend" class="btn-btn-secondary"


- BccPhoneLogin.ascx.cs

+ For form validation try to use the what the rest of Rock uses. Ref https://github.com/SparkDevNetwork/Rock/blob/develop/RockWeb/Blocks/Security/Login.ascx

- Attribute for LinkedPage "CodeEntryPage"
- Attribute for LinkedPage "AccountEntryPage"
+ public partial class BccPhoneLogin : Rock.Web.UI.RockBlock
    - public string PhoneNumber { get; set; }
    - OnInit(EventArgs e)
        + base.OnInit(e)
    - OnLoad(EventArgs e)
        + base.OnLoad(e)
        + If postback...
            + set PhoneNumber = phone number page param or null
            + if PhoneNumber is not null or empty
            + else
                + ShowInitial()
        + else,
            + ShowInitial()
    - lbInitialNext_Click
        + get phone number from textBox
        + get personId with GetPersonIdByPhoneNumber(phone number)
            + if personId is null
                + no phone number in db, show error
            + else
                + Navigate to the CodeEntryPage linked page w/ url param ?PhoneNumber=xxxxxxxxxx
    - lbInitialCreateAccount_Click
        + Do nothing for now
    - lbCodeEntryNext_Click
        + get code from tbCode
        + get personId with GetPersonIdByPhoneNumber(phone number property)
        + if personId is not null
            + get isValid from CheckCodeForPersonId(int id, int code)
            + if isValid
                + will have to login person here...
                + ref: https://github.com/SparkDevNetwork/Rock/blob/develop/RockWeb/Blocks/Security/Login.ascx.cs - btnLogin_Click
                + delete the user login so it can't be used again with public void DeleteUserLogin(int personId, int code)
            + if !isValid
                + code not valid
    - lbCodeEntryReSend_Click
    - ShowInitial
        + Hide pnlCodeEntry & pnlAccountEntry
        + Show pnlInitial
        + How to handle error messages?
    - ShowCreateAccount
        + Do nothing for now
    - ShowCodeEntry
        + Hide pnlInitial & pnlAccountEntry
        + Show pnlCodeEntry
        + How to handle error messages?